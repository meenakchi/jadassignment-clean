<!-- b2b_partner_portal.html - IMPROVED VERSION -->
<!DOCTYPE html>
<html>
<head>
    <title>Healthcare Partner Portal - Silver Care API</title>
</head>
<body>
    <h1>Partner Portal - ABC Hospital</h1>
    
    <!-- Partner Dashboard -->
    <div id="partnerStats">
        <h2>Your Statistics</h2>
        <div>Total Referrals: <span id="totalReferrals">0</span></div>
        <div>Active Bookings: <span id="activeBookings">0</span></div>
        <div>Commission Earned: $<span id="commission">0.00</span></div>
    </div>
    
    <!-- Service Catalog for Partners -->
    <div id="serviceCatalog">
        <h2>Available Services to Refer</h2>
        <div id="services"></div>
    </div>
    
    <!-- Book on Behalf of Patient -->
    <div id="bookingForm">
        <h2>Create Referral Booking</h2>
        <form id="referralForm">
            <input type="text" name="patientName" placeholder="Patient Name" required>
            <input type="email" name="patientEmail" placeholder="Patient Email" required>
            <select name="serviceId" id="serviceSelect"></select>
            <input type="date" name="bookingDate" required>
            <button type="submit">Submit Referral</button>
        </form>
    </div>
    
    <!-- Recent Referrals -->
    <div id="recentReferrals">
        <h2>Recent Referrals</h2>
        <table id="referralsTable"></table>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8080/jadassignment/api';
        const PARTNER_ID = 'PARTNER_001'; // ABC Hospital
        
        // Load partner dashboard data
        async function loadDashboard() {
            try {
                // Get services
                const servicesResponse = await fetch(`${API_BASE}/services`);
                const services = await servicesResponse.json();
                displayServices(services);
                
                // Get partner stats (you'd need to create this endpoint)
                const statsResponse = await fetch(`${API_BASE}/partner/${PARTNER_ID}/stats`);
                const stats = await statsResponse.json();
                displayStats(stats);
                
                // Get recent referrals
                const referralsResponse = await fetch(`${API_BASE}/partner/${PARTNER_ID}/referrals`);
                const referrals = await referralsResponse.json();
                displayReferrals(referrals);
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        // Submit referral booking
        document.getElementById('referralForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const booking = {
                partnerId: PARTNER_ID,
                patientName: formData.get('patientName'),
                patientEmail: formData.get('patientEmail'),
                serviceId: formData.get('serviceId'),
                bookingDate: formData.get('bookingDate'),
                referralSource: 'ABC Hospital Discharge Planning'
            };
            
            try {
                const response = await fetch(`${API_BASE}/partner/booking`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(booking)
                });
                
                if (response.ok) {
                    alert('Referral booking created successfully!');
                    loadDashboard(); // Refresh
                } else {
                    alert('Error creating booking');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
        
        function displayServices(services) {
            const container = document.getElementById('services');
            const select = document.getElementById('serviceSelect');
            
            services.forEach(service => {
                // Display in catalog
                const card = document.createElement('div');
                card.className = 'service-card';
                card.innerHTML = `
                    <h3>${service.serviceName}</h3>
                    <p>${service.description}</p>
                    <p><strong>Price: $${service.price}</strong></p>
                    <p>Duration: ${service.duration} mins</p>
                    <button onclick="quickRefer(${service.serviceId})">Quick Refer</button>
                `;
                container.appendChild(card);
                
                // Add to select dropdown
                const option = document.createElement('option');
                option.value = service.serviceId;
                option.textContent = `${service.serviceName} - $${service.price}`;
                select.appendChild(option);
            });
        }
        
        function displayStats(stats) {
            document.getElementById('totalReferrals').textContent = stats.totalReferrals;
            document.getElementById('activeBookings').textContent = stats.activeBookings;
            document.getElementById('commission').textContent = stats.commission.toFixed(2);
        }
        
        function displayReferrals(referrals) {
            const table = document.getElementById('referralsTable');
            table.innerHTML = `
                <tr>
                    <th>Date</th>
                    <th>Patient</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Commission</th>
                </tr>
            `;
            
            referrals.forEach(ref => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${ref.bookingDate}</td>
                    <td>${ref.patientName}</td>
                    <td>${ref.serviceName}</td>
                    <td>${ref.status}</td>
                    <td>$${ref.commission}</td>
                `;
            });
        }
        
        function quickRefer(serviceId) {
            document.getElementById('serviceSelect').value = serviceId;
            document.getElementById('bookingForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Load on page load
        window.addEventListener('load', loadDashboard);
    </script>
</body>
</html>